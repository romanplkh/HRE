@model IEnumerable<HorizonRE.Models.Customer>
@{
    ViewBag.Title = "Index";
    Layout = "~/Views/Shared/_Admin.cshtml";
}
<div class="container mt-md-5 mt-sm-0">
    <div class="row">
        <div class="col-sm-8 col-lg-10">
            <h2 class="display-4 mb-4">Customers</h2>
        </div>
        <div class="col-sm-4 col-lg-2">
            @Html.ActionLink("Add Customer", "AddCustomer", "Customer", null, new { @class = "btn btn-primary mt-3" })
        </div>
    </div>
    <div class="row mt-3">
        <div class="col">
            <div class="row">
                <div class="col">
                    <table id="customers" class="table table-bordered table-hover mb-5">
                        <thead class="thead-dark">
                            <tr>
                                <th class="lead">Customer Name</th>
                                <th class="lead">Address</th>
                                <th class="lead">Phone</th>
                                <th class="lead">Email</th>
                                <th class="lead">Action</th>
                            </tr>
                        </thead>
                        <tbody>
                            @foreach (var customer in Model)
                            {
                                <tr>
                                    <td> @Html.ActionLink(customer.FullName, "EditCustomer", new { customerId = customer.CustomerId }, new { @class = "lead" }) </td>
                                    <td> @customer.StreetAddress, @customer.Province, @customer.Country</td>
                                    <td> @customer.Phone</td>
                                    <td> @customer.Email</td>
                                    <td>
                                        <button class="btn btn-link delete" data-customer-id="@customer.CustomerId"
                                                data-toggle="modal" data-target="#confirmModal">
                                            Delete
                                        </button>
                                    </td>
                                </tr>
                            }
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>
</div>

@* DELETE MODAL*@
<div class="modal" id="confirmModal" tabindex="-1" role="dialog">
    <div class="modal-dialog modal-dialog-centered" role="document">
        <div class="modal-content">

            <div class="modal-header">
                <h5 class="modal-title">Delete record</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>

            <div class="modal-body">
                <p>
                    You are about to delete customer information.
                    Are you sure?
                </p>
            </div>
            <div class="modal-footer">
                @using (Html.BeginForm("Delete", "Customer", FormMethod.Post))
                {
                    @Html.AntiForgeryToken()

                    @Html.Hidden("customerId")
                    <button type="submit" class="btn btn-primary">Save changes</button>
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                }

            </div>
        </div>
    </div>
</div>

<script>
    let customerId;
    let deleteBtn = document.getElementsByClassName('delete');

    for (let i = 0; i < deleteBtn.length; i++) {
        deleteBtn[i].addEventListener('click', () => {
            customerId = deleteBtn[i].getAttribute('data-customer-id');

            setTimeout(() => {
                document.querySelector('#customerId').value = customerId;
            }, 4000)
        })
    }

</script>